–í –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–º XDP/eBPF-—Å–∏—Å—Ç–µ–º—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ **Rate Limit** ‚Äî —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å–∫–æ—Ä–æ—Å—Ç–∏ —Ç—Ä–∞—Ñ–∏–∫–∞ –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ —Å–µ—Ç–∏ –∏–ª–∏ DDoS-–∞—Ç–∞–∫.  
–†–∞–∑–ª–∏—á–∞—é—Ç –¥–≤–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–∏–ø–∞:

---

## **1. Rate Limit –ø–æ IP-–∏—Å—Ç–æ—á–Ω–∏–∫—É (`IP src`)**

**–ß—Ç–æ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç**:  
–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞–∫–µ—Ç–æ–≤/–±–∞–π—Ç, –∫–æ—Ç–æ—Ä—ã–µ **–æ–¥–∏–Ω IP-–∞–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è** –º–æ–∂–µ—Ç –ø–µ—Ä–µ–¥–∞—Ç—å –∑–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è.  

**–ó–∞—á–µ–º –Ω—É–∂–Ω–æ**:  
- –ó–∞—â–∏—Ç–∞ –æ—Ç DDoS-–∞—Ç–∞–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –±–æ—Ç–Ω–µ—Ç —à–ª–µ—Ç —Ç—ã—Å—è—á–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –æ–¥–Ω–æ–≥–æ IP).  
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–π (—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤, brute-force).  

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ eBPF**:  
- –í eBPF-–∫–∞—Ä—Ç–µ (`BPF_MAP_TYPE_LRU_HASH`) —Ö—Ä–∞–Ω–∏—Ç—Å—è —Å—á–µ—Ç—á–∏–∫ –ø–∞–∫–µ—Ç–æ–≤/–±–∞–π—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ `src_ip`.  
- –ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ –ø–∞–∫–µ—Ç—ã –æ—Ç —ç—Ç–æ–≥–æ IP –¥—Ä–æ–ø–∞—é—Ç—Å—è (`XDP_DROP`).  

**–ü—Ä–∏–º–µ—Ä –ø—Å–µ–≤–¥–æ–∫–æ–¥–∞**:  
```c
struct {
    __uint(type, BPF_MAP_TYPE_LRU_HASH);
    __type(key, __be32);  // src_ip
    __type(value, struct counter);  // { packets, bytes }
    __uint(max_entries, 100000);
} src_rate_limit SEC(".maps");

SEC("xdp")
int xdp_rate_limit(struct xdp_md *ctx) {
    __be32 src_ip = get_src_ip(ctx);
    struct counter *cnt = bpf_map_lookup_elem(&src_rate_limit, &src_ip);
    
    if (!cnt) {
        struct counter new_cnt = {1, ctx->data_end - ctx->data};
        bpf_map_update_elem(&src_rate_limit, &src_ip, &new_cnt, BPF_NOEXIST);
    } else {
        cnt->packets++;
        cnt->bytes += (ctx->data_end - ctx->data);
        if (cnt->packets > MAX_PACKETS_PER_SEC) 
            return XDP_DROP;
    }
    return XDP_PASS;
}
```

---

## **2. Rate Limit –ø–æ IP-–Ω–∞–∑–Ω–∞—á–µ–Ω–∏—é (`IP dst`)**

**–ß—Ç–æ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç**:  
–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞–∫–µ—Ç–æ–≤/–±–∞–π—Ç, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã **–Ω–∞ –æ–¥–∏–Ω IP-–∞–¥—Ä–µ—Å –ø–æ–ª—É—á–∞—Ç–µ–ª—è** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–∞—à —Å–µ—Ä–≤–µ—Ä).  

**–ó–∞—á–µ–º –Ω—É–∂–Ω–æ**:  
- –ó–∞—â–∏—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞ –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç—ã —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç–æ —Å—Ç—É—á–∞—Ç—Å—è –Ω–∞ –ø–æ—Ä—Ç 80).  
- –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏ (—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞ –º–µ–∂–¥—É —Å–µ—Ä–≤–µ—Ä–∞–º–∏).  

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ eBPF**:  
–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ `IP src`, –Ω–æ –∫–ª—é—á–æ–º –≤ –∫–∞—Ä—Ç–µ —è–≤–ª—è–µ—Ç—Å—è `dst_ip`:  
```c
struct {
    __uint(type, BPF_MAP_TYPE_LRU_HASH);
    __type(key, __be32);  // dst_ip
    __type(value, struct counter);
    __uint(max_entries, 1000);
} dst_rate_limit SEC(".maps");

SEC("xdp")
int xdp_rate_limit(struct xdp_md *ctx) {
    __be32 dst_ip = get_dst_ip(ctx);
    struct counter *cnt = bpf_map_lookup_elem(&dst_rate_limit, &dst_ip);
    // ... –ª–æ–≥–∏–∫–∞ –∫–∞–∫ –≤ –ø—Ä–∏–º–µ—Ä–µ –≤—ã—à–µ ...
}
```

---

## **üîπ –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É `IP src` –∏ `IP dst` Rate Limit**
| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞          | Rate Limit –ø–æ `src_ip`                     | Rate Limit –ø–æ `dst_ip`                     |
|-------------------------|-------------------------------------------|--------------------------------------------|
| **–¶–µ–ª—å**               | –ó–∞—â–∏—Ç–∞ –æ—Ç –∞—Ç–∞–∫ **–æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª–µ–π**           | –ó–∞—â–∏—Ç–∞ **—Å–µ—Ä–≤–µ—Ä–æ–≤** –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏          |
| **–¢–∏–ø —É–≥—Ä–æ–∑**          | DDoS, —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤                 | –§–ª—É–¥ –æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, HTTP-–∑–∞–ø—Ä–æ—Å—ã) |
| **–ö–ª—é—á –≤ eBPF-–∫–∞—Ä—Ç–µ**  | IP-–∞–¥—Ä–µ—Å –∏—Å—Ç–æ—á–Ω–∏–∫–∞                       | IP-–∞–¥—Ä–µ—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è                        |
| **–ü—Ä–∏–º–µ—Ä –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è**  | –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –±–æ—Ç–Ω–µ—Ç–∞                       | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API                 |

---

## **üîπ –ö–∞–∫ –≤—ã—á–∏—Å–ª—è—é—Ç—Å—è –ª–∏–º–∏—Ç—ã?**
1. **–ü–∞–∫–µ—Ç—ã/—Å–µ–∫—É–Ω–¥—É**:  
   ```c
   if (cnt->packets > 1000) return XDP_DROP;  // –ù–µ –±–æ–ª–µ–µ 1000 –ø–∞–∫–µ—Ç–æ–≤/—Å–µ–∫
   ```
2. **–ë–∞–π—Ç—ã/—Å–µ–∫—É–Ω–¥—É**:  
   ```c
   if (cnt->bytes > 10 * 1024 * 1024) return XDP_DROP;  // –ù–µ –±–æ–ª–µ–µ 10 –ú–ë/—Å–µ–∫
   ```

---

## **üîπ –ì–¥–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è?**
- **Cloudflare**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `src_ip` rate limiting –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç DDoS.  
- **Kubernetes Ingress**: –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∫ —Å–µ—Ä–≤–∏—Å–∞–º (`dst_ip`).  
- **–ò–≥—Ä–æ–≤—ã–µ —Å–µ—Ä–≤–µ—Ä–∞**: –ë–ª–æ–∫–∏—Ä—É—é—Ç –∏–≥—Ä–æ–∫–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —à–ª—é—Ç —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–∞–∫–µ—Ç–æ–≤.  

---

## **üîπ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –Ω—é–∞–Ω—Å—ã**
- **LRU-–∫–∞—Ä—Ç—ã**: –î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏—è —Å—Ç–∞—Ä—ã—Ö IP.  
- **–ê—Ç–æ–º–∞—Ä–Ω—ã–µ —Å—á–µ—Ç—á–∏–∫–∏**:  
  ```c
  __sync_fetch_and_add(&cnt->packets, 1);  // –ê—Ç–æ–º–∞—Ä–Ω–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ
  ```
- **–°–±—Ä–æ—Å —Å—á–µ—Ç—á–∏–∫–æ–≤**: –ß–µ—Ä–µ–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É).  
