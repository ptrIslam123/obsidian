**BCC** ‚Äî —ç—Ç–æ –º–æ—â–Ω–∞—è –∏ —É–¥–æ–±–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç **–ø–∏—Å–∞—Ç—å eBPF-–ø—Ä–æ–≥—Ä–∞–º–º—ã –Ω–∞ Python –∏–ª–∏ C++**, –∞ —Ç–∞–∫–∂–µ **–∑–∞–≥—Ä—É–∂–∞—Ç—å, —É–ø—Ä–∞–≤–ª—è—Ç—å –∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è—Ç—å –∏—Ö –∫ —Å–æ–±—ã—Ç–∏—è–º —è–¥—Ä–∞ –ø—Ä—è–º–æ –∏–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞**.

**BCC** ‚Äî —ç—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ä–∏–π, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∏–π:

- –§—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è –Ω–∞–ø–∏—Å–∞–Ω–∏—è eBPF-–ø—Ä–æ–≥—Ä–∞–º–º
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å Python –∏ Lua
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–∏–∫—Ä–µ–ø–ª—è—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—ã –∫:
  - `kprobe` / `uprobe`
  - `tracepoint`
  - `perf_event`
  - –°–µ—Ç–µ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è (`XDP`, `TC`)
  - LSM —Ö—É–∫–∏
  - –ò –¥—Ä—É–≥–∏–º –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º —Å–æ–±—ã—Ç–∏–π

BCC —Å–∞–º –∑–∞–±–æ—Ç–∏—Ç—Å—è –æ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏, –∑–∞–≥—Ä—É–∑–∫–µ –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏ —Å –∫–∞—Ä—Ç–∞–º–∏. –≠—Ç–æ –¥–µ–ª–∞–µ—Ç –µ–≥–æ –∏–¥–µ–∞–ª—å–Ω—ã–º –¥–ª—è **–±—ã—Å—Ç—Ä–æ–≥–æ –ø—Ä–æ—Ç–æ—Ç–∏–ø–∏—Ä–æ–≤–∞–Ω–∏—è, –æ—Ç–ª–∞–¥–∫–∏ –∏ –∞–Ω–∞–ª–∏–∑–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π**.

---

##  –ü—Ä–∏–º–µ—Ä: –ó–∞—Ö–≤–∞—Ç –≤—ã–∑–æ–≤–æ–≤ `execve()` —á–µ—Ä–µ–∑ Python + BCC

```python
from bcc import BPF

# eBPF –ø—Ä–æ–≥—Ä–∞–º–º–∞ –Ω–∞ C, –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –≤ Python
program = """
int handle_execve(struct pt_regs *ctx) {
    char comm[16];
    bpf_get_current_comm(&comm, sizeof(comm));
    bpf_trace_printk("New process: %s\\n", comm);
    return 0;
}
"""

# –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ–≥—Ä–∞–º–º—É
bpf = BPF(text=program)

# –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –∫ —Å–æ–±—ã—Ç–∏—é execve (sys_enter_execve)
bpf.attach_kprobe(event="sys_enter_execve", fn_name="handle_execve")

# –ß–∏—Ç–∞–µ–º –≤—ã–≤–æ–¥ trace_printk
print("Tracing execve()... Ctrl+C to end.")
try:
    while True:
        try:
            (task, pid, cpu, flags, ts, msg) = bpf.trace_fields()
            print(f"{msg}")
        except KeyboardInterrupt:
            break
except KeyboardInterrupt:
    pass
```

> üí° –ö–æ–≥–¥–∞ —Ç—ã –∑–∞–ø—É—Å–∫–∞–µ—à—å —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç, –æ–Ω:
> - –ö–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç eBPF-–ø—Ä–æ–≥—Ä–∞–º–º—É
> - –ü—Ä–∏–∫—Ä–µ–ø–ª—è–µ—Ç –µ—ë –∫ —Å–æ–±—ã—Ç–∏—é `sys_enter_execve`
> - –í—ã–≤–æ–¥–∏—Ç –∏–º—è –∫–∞–∂–¥–æ–≥–æ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞

---

## –ö–∞–∫ –≤—ã–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É?

–ö–∞–∫ —Ç–æ–ª—å–∫–æ —Ç—ã –∑–∞–≤–µ—Ä—à–∏—à—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞–∂–∞–≤ `Ctrl+C`), BCC **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–≥—Ä—É–∑–∏—Ç –ø—Ä–æ–≥—Ä–∞–º–º—É** –∏–∑ —è–¥—Ä–∞.

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å —Å–¥–µ–ª–∞—Ç—å —ç—Ç–æ —è–≤–Ω–æ:

```python
bpf.remove_kprobe(event="sys_enter_execve")
```

---

## –î—Ä—É–≥–∏–µ —Ç–∏–ø—ã —Å–æ–±—ã—Ç–∏–π, –∫ –∫–æ—Ç–æ—Ä—ã–º –º–æ–∂–Ω–æ –ø—Ä–∏–∫—Ä–µ–ø–ª—è—Ç—å—Å—è:

| –¢–∏–ø | –ú–µ—Ç–æ–¥ –≤ BCC | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----|-------------|----------|
| `kprobe` | `attach_kprobe()` | –•—É–∫ –Ω–∞ —Ñ—É–Ω–∫—Ü–∏—é —è–¥—Ä–∞ |
| `uprobe` | `attach_uprobe()` | –•—É–∫ –Ω–∞ —Ñ—É–Ω–∫—Ü–∏—é –≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ |
| `tracepoint` | `enable_tracepoint()` | –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ tracepoint –∏–∑ —è–¥—Ä–∞ |
| `xdp` | `XDP` –∫–ª–∞—Å—Å | –ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ XDP-–ø—Ä–æ–≥—Ä–∞–º–º—ã –∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É |
| `perf_event` | `open_perf_buffer()` | –ß—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ —Ç–∞–π–º–µ—Ä—É –∏–ª–∏ –∞–ø–ø–∞—Ä–∞—Ç–Ω–æ–º—É —Å–æ–±—ã—Ç–∏—é |

---

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ BCC

### –ù–∞ Ubuntu/Debian:

```bash
sudo apt install bpfcc-tools linux-headers-$(uname -r)
```

–ò–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:

```bash
sudo apt install libbpfcc-dev
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏:

```bash
python3 -c "import bcc; print(bcc.__version__)"
```
