**Агломеративная кластеризация — это метод иерархической кластеризации, который начинается с рассмотрения каждого объекта как отдельного кластера и постепенно объединяет ближайшие кластеры, пока не будет достигнуто желаемое количество кластеров или не останется один общий кластер. Этот процесс напоминает построение дерева (дендрограммы), где каждый уровень представляет собой объединение кластеров.**

## Основные этапы агломеративной кластеризации

1. **Инициализация**:
   - Каждый объект начинает как отдельный кластер.

2. **Расчет расстояний**:
   - На каждом шаге вычисляется расстояние между всеми парами кластеров. Для этого используются различные метрики, такие как:
     - **Метод одиночной связи (single linkage)**: минимальное расстояние между точками двух кластеров.
     - **Метод полной связи (complete linkage)**: максимальное расстояние между точками двух кластеров.
     - **Метод средней связи (average linkage)**: среднее расстояние между всеми парами точек из двух кластеров.
     - **Метод Уорда**: минимизация общей дисперсии при объединении кластеров.

![[Pasted image 20240823164920.png]]

3. **Объединение кластеров**:
   - На каждом шаге два ближайших кластера объединяются, и процесс повторяется до тех пор, пока не останется один кластер или не будет достигнуто заданное количество кластеров.

4. **Создание дендрограммы**:
   - Результаты агломеративной кластеризации могут быть визуализированы в виде дендрограммы, которая показывает иерархическую структуру кластеров и позволяет выбрать оптимальное количество кластеров.


### Метрики схожести кластеров

Метрики схожести (или расстояния) между кластерами являются ключевыми в агломеративной кластеризации, так как они определяют, какие кластеры будут объединены на каждом шаге. Выбор метрики может сильно влиять на результат кластеризации. Вот некоторые из основных подходов к определению расстояния между кластерами:

1. **Одиночная связь (Single Linkage):**
   - Также известна как метод ближайшего соседа.
   - Расстояние между двумя кластерами определяется как минимальное расстояние между любыми двумя точками в этих кластерах.
   - Формула: $$ d(C_i, C_j) = \min_{x \in C_i, y \in C_j} d(x, y) $$

2. **Полная связь (Complete Linkage):**
   - Также известна как метод дальнего соседа.
   - Расстояние между двумя кластерами определяется как максимальное расстояние между любыми двумя точками в этих кластерах.
   - Формула: $$ d(C_i, C_j) = \max_{x \in C_i, y \in C_j} d(x, y) $$

3. **Средняя связь (Average Linkage):**
   - Расстояние между двумя кластерами определяется как среднее расстояние между всеми парами точек, где одна точка из одного кластера, а другая из другого.
   - Формула: $$ d(C_i, C_j) = \frac{1}{|C_i||C_j|} \sum_{x \in C_i} \sum_{y \in C_j} d(x, y) $$

4. **Центроидное расстояние (Centroid Linkage):**
   - Расстояние между двумя кластерами определяется как расстояние между их центрами (средними точками).
   - Формула: $$ d(C_i, C_j) = d(\bar{x}_i, \bar{x}_j) $$, где $$ \bar{x}_i $$ и $$ \bar{x}_j $$ — центры кластеров  Ci и C_j  соответственно.

5. **Метод Уорда (Ward's Method):**
   - Минимизирует сумму квадратов отклонений точек от центров кластеров.
   - Расстояние между двумя кластерами определяется как увеличение суммы квадратов ошибок при объединении двух кластеров.
	   - Формула: $$ d(C_i, C_j) = \frac{|C_i||C_j|}{|C_i| + |C_j|} d(\bar{x}_i, \bar{x}_j)^2 $$
Метод Уорда (Ward's method) — это один из популярных методов иерархической кластеризации, который используется для группировки объектов в кластеры на основе их схожести. Он был предложен Джозефом Уордом в 1963 году и отличается от других методов тем, что для оценки расстояний между кластерами применяются методы дисперсионного анализа.

## Принцип работы метода Уорда

Метод Уорда минимизирует внутрикластерную дисперсию, что достигается путем объединения кластеров, которые приводят к наименьшему увеличению общей [[Дисперсия]]. При каждом шаге алгоритма выбираются два кластера, объединение которых приводит к минимальному увеличению суммы квадратов расстояний от объектов до центров этих кластеров.

### Формула расчета

Расстояние между кластерами определяется как прирост суммы квадратов расстояний (SSW - sum of squares within) при их объединении:

$$
\Delta S = S_{before} - S_{after}
$$

где $$S_{before}$$ — сумма квадратов расстояний до центроидов до объединения кластеров, а $$S_{after}$$ — сумма квадратов расстояний после объединения.

## Преимущества и недостатки

### Преимущества

1. **Минимизация дисперсии**: Метод Уорда стремится к созданию компактных и однородных кластеров, что делает его эффективным для задач, где важно сохранить однородность внутри кластеров.

2. **Подходит для различных типов данных**: Метод хорошо работает как с числовыми, так и с категориальными данными, если они предварительно преобразованы в числовые.

### Недостатки

1. **Вычислительная сложность**: Метод требует значительных вычислительных ресурсов, особенно при работе с большими наборами данных, поскольку его сложность квадратично возрастает с увеличением числа объектов.

2. **Чувствительность к выбросам**: Как и многие другие методы кластеризации, метод Уорда может быть чувствителен к выбросам, что может негативно сказаться на качестве кластеризации.


Каждый из этих методов имеет свои преимущества и недостатки, и выбор конкретного метода зависит от характера данных и целей кластеризации. Например, одиночная связь склонна к образованию цепочек (проблема "цепочки"), в то время как полная связь может приводить к образованию компактных кластеров. Метод Уорда, как правило, дает хорошо разделимые кластеры, но может быть чувствителен к выбросам.

## Преимущества и недостатки

### Преимущества:
- **Гибкость**: Метод может адаптироваться к различным формам кластеров и структуре данных.
- **Информативность**: Позволяет строить иерархическую структуру кластеров, что помогает лучше понять взаимосвязи между ними.
- **Отсутствие необходимости в предварительном определении числа кластеров**: Алгоритм может автоматически определить количество кластеров на основе данных.

### Недостатки:
- **Высокие вычислительные затраты**: Алгоритм требует значительных ресурсов, особенно при работе с большими наборами данных, так как необходимо хранить и обновлять матрицу расстояний.
- **Чувствительность к выбросам**: Наличие выбросов может существенно повлиять на результаты кластеризации.

Таким образом, агломеративная кластеризация является мощным инструментом для анализа данных, позволяющим выявлять скрытые структуры и взаимосвязи в наборе данных.





### Формула Ланса-Уильямса

Формула Ланса-Уильямса (Lance-Williams formula) — это рекурсивная формула, используемая в иерархическом кластерном анализе для обновления расстояний между кластерами при каждом шаге агломеративного алгоритма. Эта формула универсальна и применима к различным метрикам расстояния, таким как метод одиночной связи (single linkage), метод полной связи (complete linkage), метод средней связи (average linkage) и другие.

Формула Ланса-Уильямса имеет следующий вид:

\[ d(R \cup S, T) = \alpha_R d(R, T) + \alpha_S d(S, T) + \beta d(R, S) + \gamma |d(R, T) - d(S, T)| \]

где:
- \( d(R \cup S, T) \) — расстояние между объединенным кластером \( R \cup S \) и кластером \( T \);
- \( d(R, T) \) и \( d(S, T) \) — расстояния между кластерами \( R \) и \( T \), а также \( S \) и \( T \) соответственно;
- \( d(R, S) \) — расстояние между кластерами \( R \) и \( S \);
- \( \alpha_R \), \( \alpha_S \), \( \beta \), и \( \gamma \) — коэффициенты, зависящие от конкретного метода кластеризации.

Значения коэффициентов для некоторых распространенных методов кластеризации:

1. **Метод одиночной связи (single linkage)**:
   - \( \alpha_R = \alpha_S = 0.5 \)
   - \( \beta = 0 \)
   - \( \gamma = -0.5 \)

2. **Метод полной связи (complete linkage)**:
   - \( \alpha_R = \alpha_S = 0.5 \)
   - \( \beta = 0 \)
   - \( \gamma = 0.5 \)

3. **Метод средней связи (average linkage)**:
   - \( \alpha_R = \frac{n_R}{n_R + n_S} \)
   - \( \alpha_S = \frac{n_S}{n_R + n_S} \)
   - \( \beta = 0 \)
   - \( \gamma = 0 \)
   где \( n_R \) и \( n_S \) — количество объектов в кластерах \( R \) и \( S \) соответственно.

Формула Ланса-Уильямса позволяет эффективно обновлять расстояния между кластерами на каждом шаге агломеративного алгоритма, что делает ее широко используемой в практике кластерного анализа.
