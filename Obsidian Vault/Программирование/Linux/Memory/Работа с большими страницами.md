–í –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ **DPDK** —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **—Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ä–∞–∑–º–µ—Ä–æ–º 1 GB (Hugepages 1G)**, –µ—Å–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –∏ —Å–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç —Ç–∞–∫–æ–π —Ä–∞–∑–º–µ—Ä. –û–¥–Ω–∞–∫–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º –∏ –Ω–∞–∏–±–æ–ª–µ–µ —à–∏—Ä–æ–∫–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–º –≤–∞—Ä–∏–∞–Ω—Ç–æ–º —è–≤–ª—è—é—Ç—Å—è **2 MB —Å—Ç—Ä–∞–Ω–∏—Ü—ã (Hugepages 2M)**.  

### **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ DPDK**  
1. **1 GB hugepages (–ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–æ)**  
   - **–ü–ª—é—Å—ã:**  
     - –£–º–µ–Ω—å—à–∞–µ—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ TLB-–ø—Ä–æ–º–∞—Ö–æ–≤ (Translation Lookaside Buffer).  
     - –£–ª—É—á—à–∞–µ—Ç—Å—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö.  
   - **–ú–∏–Ω—É—Å—ã:**  
     - –¢—Ä–µ–±—É—é—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ CPU (`pdpe1gb` –≤ `/proc/cpuinfo`).  
     - –ú–æ–≥—É—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–∞–º—è—Ç–∏, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ –º–∞–ª–æ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π RAM.  

2. **2 MB hugepages (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç)**  
   - **–ü–ª—é—Å—ã:**  
     - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –ø–æ—á—Ç–∏ –≤—Å–µ–º–∏ x86_64 –∏ ARM-—Å–∏—Å—Ç–µ–º–∞–º–∏.  
     - –ì–∏–±–∫–æ—Å—Ç—å –≤ –≤—ã–¥–µ–ª–µ–Ω–∏–∏ (–º–æ–∂–Ω–æ –±—Ä–∞—Ç—å –Ω–µ–±–æ–ª—å—à–∏–µ –æ–±—ä–µ–º—ã).  
   - **–ú–∏–Ω—É—Å—ã:**  
     - –ë–æ–ª—å—à–µ –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤ –Ω–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å 1G.  

---

### **–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ª–∏ —Å–∏—Å—Ç–µ–º–∞ 1GB hugepages?**  
```bash
grep pdpe1gb /proc/cpuinfo
```  
–ï—Å–ª–∏ –µ—Å—Ç—å –≤—ã–≤–æ–¥ ‚Äì –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç 1GB —Å—Ç—Ä–∞–Ω–∏—Ü—ã.  

---

### **–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**  
#### **1. –î–ª—è –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º (–ª—É—á—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)**  
```bash
# –í—ã–¥–µ–ª–∏—Ç—å 1GB hugepages (–Ω–∞–ø—Ä–∏–º–µ—Ä, 4 —à—Ç = 4GB)
echo 4 | sudo tee /sys/kernel/mm/hugepages/hugepages-1048576kB/nr_hugepages
```  
**–ü–ª—é—Å—ã:**  
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã DPDK.  
- –ú–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ MMU (Memory Management Unit).  

#### **2. –î–ª—è –æ–±—ã—á–Ω—ã—Ö —Å–∏—Å—Ç–µ–º (–±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –∏ –≥–∏–±–∫–æ—Å—Ç—å—é)**  
```bash
# –í—ã–¥–µ–ª–∏—Ç—å 2MB hugepages (–Ω–∞–ø—Ä–∏–º–µ—Ä, 2048 —à—Ç = 4GB)
echo 2048 | sudo tee /sys/kernel/mm/hugepages/hugepages-2048kB/nr_hugepages
```  
**–ü–ª—é—Å—ã:**  
- –†–∞–±–æ—Ç–∞–µ—Ç –ø–æ—á—Ç–∏ –≤–µ–∑–¥–µ.  
- –ú–æ–∂–Ω–æ –≤—ã–¥–µ–ª—è—Ç—å –ø–∞–º—è—Ç—å –±–æ–ª–µ–µ –≥–∏–±–∫–æ.  

#### **3. –ü–æ—Å–ª–µ –≤—ã–¥–µ–ª–µ–Ω–∏—è –±–æ–ª—å—à–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü –º–æ–∂–ø—Ä–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –æ–Ω–∏ —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã**
```bash
mount | grep hugetlbfs
```

–ï—Å–ª–∏ –≤—ã–≤–æ–¥–∏—Ç –Ω–∞ –ø–æ–¥–æ–±–∏–∏ —ç—Ç–æ–≥–æ: hugetlbfs on /dev/hugepages type hugetlbfs (rw,relatime) - —Ç–æ —É–∂–µ –≤—Å–µ —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ

#### **4. –ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–æ–ª—å—à–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü**
```bash
sudo mkdir -p /dev/hugepages
sudo mount -t hugetlbfs hugetlbfs /dev/hugepages
```

#### **–î–∞—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ `/dev/hugepages` (–µ—Å–ª–∏ DPDK –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–µ –æ—Ç root):**
```bash
sudo chmod 777 /dev/hugepages
```

---

### **–ß—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç DPDK –≤ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏?**  
–í **—Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–µ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –ø–∞–º—è—Ç–∏ (Memory Configuration)** —É–∫–∞–∑–∞–Ω–æ:  
> *"For optimal performance, use 1GB hugepages when available. If 1GB pages are not supported, 2MB pages are the recommended alternative."*  

–¢–∞–∫–∂–µ —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è:  
- –ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç **–±–æ–ª—å—à–∏—Ö –±—É—Ñ–µ—Ä–æ–≤** (–Ω–∞–ø—Ä–∏–º–µ—Ä, 10GB+), 1GB —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–∞–¥—É—Ç –ª—É—á—à—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.  
- –î–ª—è **–º–∞–ª—ã—Ö —Å–∏—Å—Ç–µ–º** (–∏–ª–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—à–∏–Ω) –º–æ–∂–Ω–æ –æ–±–æ–π—Ç–∏—Å—å 2MB.  

---

### **–ö–∞–∫–æ–π —Ä–∞–∑–º–µ—Ä –≤—ã–±—Ä–∞—Ç—å?**  
| –ö—Ä–∏—Ç–µ—Ä–∏–π               | 1GB Hugepages | 2MB Hugepages |
|------------------------|--------------|--------------|
| **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ CPU**       | –¢—Ä–µ–±—É–µ—Ç `pdpe1gb` | –†–∞–±–æ—Ç–∞–µ—Ç –ø–æ—á—Ç–∏ –≤–µ–∑–¥–µ |
| **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è | –•–æ—Ä–æ—à–∞—è |
| **–ì–∏–±–∫–æ—Å—Ç—å**           | –¢—Ä–µ–±—É–µ—Ç –º–Ω–æ–≥–æ –ø–∞–º—è—Ç–∏ –∑–∞ —Ä–∞–∑ | –ú–æ–∂–Ω–æ –≤—ã–¥–µ–ª—è—Ç—å –Ω–µ–±–æ–ª—å—à–∏–µ –±–ª–æ–∫–∏ |
| **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è DPDK**  | ‚úÖ –õ—É—á—à–∏–π –≤—ã–±–æ—Ä | ‚úÖ –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç |

**–í—ã–≤–æ–¥:**  
- **–ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç 1GB —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –∏–º–µ–µ—Ç –º–Ω–æ–≥–æ RAM ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ 1GB.**  
- **–ï—Å–ª–∏ –Ω–µ—Ç –∏–ª–∏ –Ω—É–∂–Ω–æ –≥–∏–±–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é ‚Üí 2MB.**  

---

### **–ö–∞–∫ —É–∫–∞–∑–∞—Ç—å —Ä–∞–∑–º–µ—Ä hugepages –≤ DPDK?**  
–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ `dpdk-testpmd` –º–æ–∂–Ω–æ —è–≤–Ω–æ –∑–∞–¥–∞—Ç—å —Ä–∞–∑–º–µ—Ä:  
```bash
# –î–ª—è 1GB —Å—Ç—Ä–∞–Ω–∏—Ü
sudo ./dpdk-testpmd --socket-mem=1024,1024 --huge-dir=/dev/hugepages1G ...

# –î–ª—è 2MB —Å—Ç—Ä–∞–Ω–∏—Ü
sudo ./dpdk-testpmd --socket-mem=1024,1024 --huge-dir=/dev/hugepages ...
```  

–ï—Å–ª–∏ –≤—Å—ë –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ, DPDK –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–µ—Ä–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç.  

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∫–∞–∫–∏–µ hugepages –∏—Å–ø–æ–ª—å–∑—É–µ—Ç DPDK:**  
```bash
sudo cat /proc/meminfo | grep Huge
```  

### –†–∞–±–æ—Ç–∞ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏ –ø–∞–º—è—Ç–∏ —á–µ—Ä–µ–∑  dpdk-hugepages.py

```bash
sudo ./dpdk-hugepages.py -p 1G --setup 10G # –≤—ã–¥–µ–ª–∏–ª–∏ 10 —Å—Ç—Ä–∞–Ω–∏—Ü –ø–æ 1–ì–ë
sudo ./dpdk-hugepages.py -p 2M --setup 10G # –≤—ã–¥–µ–ª–∏–ª–∏ 10 —Å—Ç—Ä–∞–Ω–∏—Ü –ø–æ 2–ú–ë
./dpdk-hugepages.py -s # –≤—ã–≤–µ—Å—Ç–∏ —Ç–µ–∫—É—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –±–æ–ª—å—à–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü –≤ —Å–∏—Å—Ç–µ–º–µ
```











----
---
---

## **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±—â—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü—é –æ –ø–∞–º—è—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º–µ**
```bash
cat /proc/meminfo | grep Huge
```

–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:
```txt
AnonHugePages:         0 kB
ShmemHugePages:        0 kB
FileHugePages:         0 kB
HugePages_Total:    1024
HugePages_Free:     1024
HugePages_Rsvd:        0
HugePages_Surp:        0
Hugepagesize:       2048 kB
Hugetlb:          2097152 kB
```

#### –ß—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç?

| –ü–æ–ª–µ              | –ó–Ω–∞—á–µ–Ω–∏–µ                                                                 |
| ----------------- | ------------------------------------------------------------------------ |
| `HugePages_Total` | –í—Å–µ–≥–æ –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö hugepages (–ø–æ 2 MB)                              |
| `HugePages_Free`  | –°–≤–æ–±–æ–¥–Ω—ã—Ö hugepages                                                      |
| `Hugepagesize`    | –†–∞–∑–º–µ—Ä –æ–¥–Ω–æ–π hugepage                                                    |
| `Hugetlb`         | –û–±—â–∏–π –æ–±—ä—ë–º –ø–∞–º—è—Ç–∏ –≤ KB –ø–æ–¥ hugepages (`HugePages_Total * Hugepagesize`) |

üëâ **–ò—Ç–æ–≥–æ –¥–æ—Å—Ç—É–ø–Ω–æ–π –ø–∞–º—è—Ç–∏ –ø–æ–¥ hugepages** :  
`HugePages_Free * Hugepagesize` ‚Üí –Ω–∞–ø—Ä–∏–º–µ—Ä:  
`1024 * 2048 KB = 2097152 KB = ~2 GB`

## **–°–∫–æ–ª—å–∫–æ –≤—Å–µ–≥–æ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –ø–∞–º—è—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω–æ**
```bash
free -h
# –∏–ª–∏
cat /proc/meminfo | grep MemTotal
```

## –£–∑–Ω–∞—Ç—å NUMA –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
```bash
numactl -H
```

* **–ü—Ä–∏–≤–µ—Ä–Ω—ã–π –≤—ã–≤–æ–¥:** 
	available: 2 nodes (0-1)
	node 0 cpus: 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23
	node 0 size: 128297 MB
	node 0 free: 127488 MB
	node 1 cpus: 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47
	node 1 size: 129012 MB
	node 1 free: 128272 MB
	node distances:
	node   0   1 
	  0:  10  21 
	  1:  21  10 

–í—ã–≤–æ–¥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —á—Ç–æ –≤ —Å–∏—Å—Ç–µ–º–µ **2 NUMA-—Å–æ–∫–µ—Ç–∞** , –ø–æ **~128 –ì–ë –ø–∞–º—è—Ç–∏ –Ω–∞ –∫–∞–∂–¥—ã–π** , –∏ –ø–æ—á—Ç–∏ –≤—Å—è –ø–∞–º—è—Ç—å **—Å–≤–æ–±–æ–¥–Ω–∞** . 0 NUMA-socket –∏–º–µ–µ—Ç —è–¥—Ä–∞ 0-23, 1 NUMA-socket –∏–º–µ–µ—Ç —è–¥—Ä–∞ 24-47 

## –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö hugepages –Ω–∞ –∫–∞–∂–¥–æ–º NUMA-—Å–æ–∫–µ—Ç–µ

–î–ª—è –∫–∞–∂–¥–æ–≥–æ NUMA-—Å–æ–∫–µ—Ç–∞ –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞:
```bash
cat /sys/devices/system/node/node<N>/hugepages/hugepages-<size>kB/nr_hugepages
—Åat /sys/devices/system/node/node<N>/hugepages/hugepages-<size>kB/free_hugepages
```
–ì–¥–µ:
- `<N>` ‚Äî –Ω–æ–º–µ—Ä NUMA-—Å–æ–∫–µ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `node0`, `node1`)
- `<size>` ‚Äî —Ä–∞–∑–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã: `2048` –¥–ª—è 2MB –∏–ª–∏ `1048576` –¥–ª—è 1GB
- –ö–æ–º–∞–Ω–¥–∞ –≤—ã–≤–µ–¥–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü
#### –ü—Ä–∏–º–µ—Ä
* –î–ª—è 2MB hugepages:
```bash
# node0
cat /sys/devices/system/node/node0/hugepages/hugepages-2048kB/{nr_hugepages,free_hugepages}

# node1
cat /sys/devices/system/node/node1/hugepages/hugepages-2048kB/{nr_hugepages,free_hugepages}```

* –î–ª—è 1GB hugepages:
```bash
# node0
cat /sys/devices/system/node/node0/hugepages/hugepages-1048576kB/{nr_hugepages,free_hugepages}

# node1
cat /sys/devices/system/node/node1/hugepages/hugepages-1048576kB/{nr_hugepages,free_hugepages}
```

## –í—ã–¥–µ–ª–µ–Ω–∏–µ/—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –±–æ–ª—å—à–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü –ø–∞–º—è—Ç–∏

> **–ö–æ—Ä–æ—Ç–∫–∏–π –æ—Ç–≤–µ—Ç:**
> –î–∞, –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å—Ç–æ —É–∫–∞–∑–∞—Ç—å –æ–±—â–µ–µ —á–∏—Å–ª–æ hugepages, –∏ DPDK –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Ö ¬´–≥–ª–æ–±–∞–ª—å–Ω–æ¬ª, –Ω–æ **–¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è **—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞—Ç—å hugepages –Ω–∞ –∫–∞–∂–¥–æ–º NUMA-—Å–æ–∫–µ—Ç–µ –æ—Ç–¥–µ–ª—å–Ω–æ**, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –º–µ–∂—Å–æ–∫–µ—Ç–Ω–æ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞ –∏ –ø–æ–≤—ã—Å–∏—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã —Å –ø–∞–º—è—Ç—å—é.


### –ü—Ä–æ—Å—Ç–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü –±–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏ –≤ NUMA –Ω–æ–¥–∞–º:
```bash
echo 1024 > /proc/sys/vm/nr_hugepages
```

- –í—ã–¥–µ–ª—è—é—Ç—Å—è hugepages **–Ω–∞ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö NUMA-—Å–æ–∫–µ—Ç–∞—Ö**, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
- –Ø–¥—Ä–æ —Å–∞–º–æ —Ä–µ—à–∞–µ—Ç, –≥–¥–µ –∏–º–µ–Ω–Ω–æ (node0 –∏–ª–∏ node1) –±—É–¥—É—Ç –≤—ã–¥–µ–ª–µ–Ω—ã —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω—ã–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, —è–¥—Ä–æ –º–æ–∂–µ—Ç –≤—ã–¥–µ–ª–∏—Ç—å –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–∞ –æ–¥–Ω–æ–π NUMA-–Ω–æ–¥–µ, –µ—Å–ª–∏ –Ω–∞ –¥—Ä—É–≥–æ–π –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –ø–∞–º—è—Ç–∏).
- DPDK –∏ –¥—Ä—É–≥–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–∏ hugepages, –Ω–æ **–Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç**, —á—Ç–æ mbuf/–æ—á–µ—Ä–µ–¥–∏ –±—É–¥—É—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è —Ä—è–¥–æ–º —Å —è–¥—Ä–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –∏—Ö –∏—Å–ø–æ–ª—å–∑—É—é—Ç ‚Üí –≤–æ–∑–º–æ–∂–Ω—ã **–º–µ–∂—Å–æ–∫–µ—Ç–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏**.

–≠—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ **–Ω–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ** –¥–ª—è –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á.

**–î–ª—è DPDK –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å, —á—Ç–æ `--socket-mem` –ø–æ–∑–≤–æ–ª—è–µ—Ç —è–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å, —Å–∫–æ–ª—å–∫–æ –ø–∞–º—è—Ç–∏ –≤—ã–¥–µ–ª–∏—Ç—å –Ω–∞ –∫–∞–∂–¥–æ–π NUMA-–Ω–æ–¥–µ.**
### –†–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ hugepages **–ø–æ NUMA** —É–∑–ª–∞–º

–ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ `--socket-num=1` –∏ `--numa`, —Ç–æ –ª—É—á—à–µ **—è–≤–Ω–æ –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞—Ç—å hugepages –Ω–∞ –Ω—É–∂–Ω–æ–º NUMA-—Å–æ–∫–µ—Ç–µ**.

```bash
# –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä—É–µ—Ç 1 hugepages (—Å—Ç—Ä–∞–Ω–∏—Ü —Å —Ä–∞–∑–º–µ—Ä–æ–º 2MB)–Ω–∞ NUMA-—Å–æ–∫–µ—Ç–µ `node0`
echo 1 > /sys/devices/system/node/node0/hugepages/hugepages-2048kB/nr_hugepages

# –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä—É–µ—Ç 1 hugepages (—Å—Ç—Ä–∞–Ω–∏—Ü —Å —Ä–∞–∑–º–µ—Ä–æ–º 1–ì–ë)–Ω–∞ NUMA-—Å–æ–∫–µ—Ç–µ `node0`
echo 1 > /sys/devices/system/node/node0/hugepages/hugepages-1048576kB/nr_hugepages

# –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä—É–µ—Ç 1 hugepages (—Å—Ç—Ä–∞–Ω–∏—Ü —Å —Ä–∞–∑–º–µ—Ä–æ–º 2MB)–Ω–∞ NUMA-—Å–æ–∫–µ—Ç–µ `node1`
echo 1 > /sys/devices/system/node/node1/hugepages/hugepages-2048kB/nr_hugepages

# –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä—É–µ—Ç 1 hugepages (—Å—Ç—Ä–∞–Ω–∏—Ü —Å —Ä–∞–∑–º–µ—Ä–æ–º 1–ì–ë)–Ω–∞ NUMA-—Å–æ–∫–µ—Ç–µ `node1`
echo 1 > /sys/devices/system/node/node1/hugepages/hugepages-1048576kB/nr_hugepages
```

–¢–æ–≥–¥–∞:
- –ù–∞ –∫–∞–∂–¥–æ–º NUMA-—Å–æ–∫–µ—Ç–µ –±—É–¥–µ—Ç ~120 –ì–ë –ø–∞–º—è—Ç–∏ –ø–æ–¥ hugepages.
- DPDK –∏ –¥—Ä—É–≥–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–º–æ–≥—É—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—Ç—å –ø—É–ª—ã mbuf, –æ—á–µ—Ä–µ–¥–∏ RX/TX –∏ –∫–æ–ª—å—Ü–∞ **–ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ –∫–∞–∂–¥–æ–º NUMA-—Å–æ–∫–µ—Ç–µ**.
- –≠—Ç–æ –¥–∞—ë—Ç:
  - –ë–æ–ª–µ–µ –Ω–∏–∑–∫—É—é –∑–∞–¥–µ—Ä–∂–∫—É,
  - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –ø—Ä–æ–ø—É—Å–∫–Ω—É—é —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å,
  - –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ NUMA-–º–∏–≥—Ä–∞—Ü–∏–∏ –ø–∞–º—è—Ç–∏.


### **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –ª–∏ hugetlbfs**
```bash
mount | grep hugetlbfs
```

–ï—Å–ª–∏ –≤—ã–≤–æ–¥ –µ—Å—Ç—å, –Ω–∞–ø—Ä–∏–º–µ—Ä: `none on /mnt/huge type hugetlbfs (rw,relatime,pagesize=2M)`

–ó–Ω–∞—á–∏—Ç –≤—Å—ë —É–∂–µ —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ. –ï—Å–ª–∏ –≤—ã–≤–æ–¥–∞ –Ω–µ—Ç, –Ω—É–∂–Ω–æ —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å.

### **–°–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å hugetlbfs

#### –î–ª—è 2MB hugepages:
```bash
sudo mkdir -p /mnt/huge
sudo mount -t hugetlbfs none /mnt/huge -o pagesize=2MB
```

#### –î–ª—è 1GB hugepages:
```bash
sudo mkdir -p /mnt/huge_1gb
sudo mount -t hugetlbfs none /mnt/huge_1gb -o pagesize=1GB
```

### **–ó–∞–ø—É—Å–∫ `dpdk-testpmd` —Å —É–∫–∞–∑–∞–Ω–∏–µ–º `--huge-dir`**

–ß—Ç–æ–±—ã DPDK –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª —ç—Ç–∏ –±–æ–ª—å—à–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ `dpdk-testpmd` –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∂–∏—Ç–µ:
```bash
--huge-dir=/mnt/huge_1gb
```

## –ü—Ä–∏–º–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ–ª—å—à–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü

```bash
# —Å–º–æ—Ç—Ä–∏–º —Å–∫–æ–ª–∫—å–æ –¥–æ—Å—Ç—É–ø–Ω–æ —Å—Ç—Ä–∞–Ω–∏—Ü –ø–æ 2–ú–ë –Ω–∞ `node0`
cat /sys/devices/system/node/node0/hugepages/hugepages-2048kB/{nr_hugepages,free_hugepages}
# –≤—ã–≤–æ–¥: 0

# —Å–º–æ—Ç—Ä–∏–º —Å–∫–æ–ª–∫—å–æ –¥–æ—Å—Ç—É–ø–Ω–æ —Å—Ç—Ä–∞–Ω–∏—Ü –ø–æ 2–ú–ë –Ω–∞ `node1`
cat /sys/devices/system/node/node1/hugepages/hugepages-2048kB/{nr_hugepages,free_hugepages}
# –≤—ã–≤–æ–¥: 0

sudo su
# —Ä–µ–∑–µ—Ä–≤–∏—Ä—É–µ–º 50 —Å—Ç—Ä–∞–Ω–∏—Ü –ø–æ 1–ì–ë –Ω–∞ `node0`
echo 50 > /sys/devices/system/node/node0/hugepages/hugepages-1048576kB/nr_hugepages

# —Ä–µ–∑–µ—Ä–≤–∏—Ä—É–µ–º 50 —Å—Ç—Ä–∞–Ω–∏—Ü –ø–æ 1–ì–ë –Ω–∞ `node1`
echo 50 > /sys/devices/system/node/node1/hugepages/hugepages-1048576kB/nr_hugepages

# —Å–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü
sudo mkdir -p /mnt/huge_1gb

# –º–æ–Ω—Ç–∏—Ä—É–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—ã
sudo mount -t hugetlbfs none /mnt/huge_1gb -o pagesize=1GB
```

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è

–î–æ–±–∞–≤—å—Ç–µ –≤ `/etc/default/grub`:

```bash
GRUB_CMDLINE_LINUX="default_hugepagesz=2MB hugepagesz=2M hugepages=122880"
```

–ê –≤ `/etc/fstab`:
```
hugetlbfs       /mnt/huge     hugetlbfs   defaults,pagesize=2MB      0 0
```

–ò –æ–±–Ω–æ–≤–∏—Ç–µ GRUB:
```bash
sudo update-grub
```
