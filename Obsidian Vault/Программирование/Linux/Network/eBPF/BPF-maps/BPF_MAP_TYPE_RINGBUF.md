`BPF_MAP_TYPE_RINGBUF` ‚Äî —ç—Ç–æ –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è **–æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–µ–π –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö** –∏–∑ eBPF-–ø—Ä–æ–≥—Ä–∞–º–º (—è–¥—Ä–æ) –≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ. –û–Ω–∞ –ø—Ä–∏—à–ª–∞ –Ω–∞ —Å–º–µ–Ω—É —É—Å—Ç–∞—Ä–µ–≤—à–µ–º—É `BPF_MAP_TYPE_PERF_EVENT_ARRAY` –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç **–º–µ–Ω—å—à–∏–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã** –∏ **–±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏**.

---

## **1. –û—Å–Ω–æ–≤–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏**
| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞          | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------------------------|----------|
| **–¢–∏–ø –¥–∞–Ω–Ω—ã—Ö**          | –ö–æ–ª—å—Ü–µ–≤–æ–π –±—É—Ñ–µ—Ä (ring buffer) |
| **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**          | –ü–µ—Ä–µ–¥–∞—á–∞ —Å–æ–±—ã—Ç–∏–π/–¥–∞–Ω–Ω—ã—Ö –∏–∑ —è–¥—Ä–∞ –≤ userspace |
| **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**  | –í—ã—Å–æ–∫–∞—è (–º–µ–Ω—å—à–∏–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã, —á–µ–º —É perf_buffer) |
| **–°–µ–º–∞–Ω—Ç–∏–∫–∞ –¥–æ—Å—Ç—É–ø–∞**   | Single Producer, Single Consumer (SPSC) |
| **–†–∞–∑–º–µ—Ä**              | –§–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ (–æ–±—ã—á–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ–≥–∞–±–∞–π—Ç) |
| **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤ —è–¥—Ä–µ**    | Linux 5.8+ |

---

## **2. –û–±—ä—è–≤–ª–µ–Ω–∏–µ –≤ eBPF-–ø—Ä–æ–≥—Ä–∞–º–º–µ**
```c
struct {
    __uint(type, BPF_MAP_TYPE_RINGBUF);
    __uint(max_entries, 1 << 24); // 16 MB (—Ä–∞–∑–º–µ—Ä –±—É—Ñ–µ—Ä–∞)
} ringbuf SEC(".maps");
```
- **`max_entries`** ‚Äî —Ä–∞–∑–º–µ—Ä –±—É—Ñ–µ—Ä–∞ **–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å—Ç–µ–ø–µ–Ω—å—é –¥–≤–æ–π–∫–∏** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `1 << 20` = 1 MB).
- **–ù–µ—Ç `key` –∏ `value`** ‚Äî –¥–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –∫–∞–∫ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã.

---

## **3. –†–∞–±–æ—Ç–∞ —Å `ringbuf` –≤ eBPF (—è–¥—Ä–æ)**

#### **1. `bpf_ringbuf_reserve()` ‚Äî —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Å—Ç–∞ –≤ –±—É—Ñ–µ—Ä–µ**
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**:  
–í—ã–¥–µ–ª—è–µ—Ç –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π —É—á–∞—Å—Ç–æ–∫ –ø–∞–º—è—Ç–∏ –≤ –∫–æ–ª—å—Ü–µ–≤–æ–º –±—É—Ñ–µ—Ä–µ –¥–ª—è –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö.

**–°–∏–≥–Ω–∞—Ç—É—Ä–∞**:
```c
void *bpf_ringbuf_reserve(struct bpf_map *ringbuf, u64 size, u64 flags);
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
- `ringbuf` ‚Äî —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –∫–æ–ª—å—Ü–µ–≤–æ–π –±—É—Ñ–µ—Ä (–æ–±—ä—è–≤–ª–µ–Ω–Ω—ã–π –≤ `SEC(".maps")`).
- `size` ‚Äî —Ä–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –∑–∞–ø–∏—Å–∞—Ç—å (–≤ –±–∞–π—Ç–∞—Ö).
- `flags`:
  - `0` ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ.
  - `BPF_RB_NO_WAKEUP` / `BPF_RB_FORCE_WAKEUP` (–≤–ª–∏—è—é—Ç –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏ `submit`).

**–í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ**:
- –£–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω—É—é –ø–∞–º—è—Ç—å (–µ—Å–ª–∏ –º–µ—Å—Ç–æ –µ—Å—Ç—å).
- `NULL` ‚Äî –µ—Å–ª–∏ –±—É—Ñ–µ—Ä –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω.

**–ü—Ä–∏–º–µ—Ä**:
```c
struct event *e = bpf_ringbuf_reserve(&ringbuf, sizeof(struct event), 0);
if (!e) {
    bpf_printk("Buffer full!");
    return 0;
}
```

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç**:
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ –≤ –±—É—Ñ–µ—Ä–µ —Å–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ.
2. –ï—Å–ª–∏ –µ—Å—Ç—å ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –ø–∞–º—è—Ç—å, –∫–æ—Ç–æ—Ä—É—é –º–æ–∂–Ω–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å.
3. –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `NULL`.

---

#### **2. `bpf_ringbuf_submit()` ‚Äî —Ñ–∏–∫—Å–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**:  
–ü—É–±–ª–∏–∫—É–µ—Ç –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –¥–µ–ª–∞—è –∏—Ö –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –¥–ª—è —á—Ç–µ–Ω–∏—è –≤ userspace.

**–°–∏–≥–Ω–∞—Ç—É—Ä–∞**:
```c
void bpf_ringbuf_submit(void *data, u64 flags);
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
- `data` ‚Äî —É–∫–∞–∑–∞—Ç–µ–ª—å, –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –æ—Ç `bpf_ringbuf_reserve()`.
- `flags`:
  - `0` ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø—Ä–æ—Ü–µ—Å—Å –ø–æ–ª—É—á–∏—Ç —Å–∏–≥–Ω–∞–ª).
  - `BPF_RB_NO_WAKEUP` ‚Äî –¥–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∞–Ω—ã, –Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ.
  - `BPF_RB_FORCE_WAKEUP` ‚Äî —Ñ–æ—Ä—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (–¥–∞–∂–µ –µ—Å–ª–∏ –±—É—Ñ–µ—Ä –ø–æ—á—Ç–∏ –ø—É—Å—Ç).

**–ü—Ä–∏–º–µ—Ä**:
```c
bpf_ringbuf_submit(e, 0);  // –° —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º
bpf_ringbuf_submit(e, BPF_RB_NO_WAKEUP);  // –ë–µ–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
1. –î–∞–Ω–Ω—ã–µ –ø–æ–º–µ—â–∞—é—Ç—Å—è –≤ –±—É—Ñ–µ—Ä.
2. –ï—Å–ª–∏ `flags != BPF_RB_NO_WAKEUP` ‚Äî userspace –ø–æ–ª—É—á–∏—Ç —Å–∏–≥–Ω–∞–ª –æ –Ω–æ–≤–æ–º —Å–æ–±—ã—Ç–∏–∏.

---

#### **3. `bpf_ringbuf_discard()` ‚Äî –æ—Ç–º–µ–Ω–∞ –∑–∞–ø–∏—Å–∏**
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**:  
–û—Ç–º–µ–Ω—è–µ—Ç —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Å—Ç–∞ (–¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–ø–∞–¥—É—Ç –≤ –±—É—Ñ–µ—Ä).

**–°–∏–≥–Ω–∞—Ç—É—Ä–∞**:
```c
void bpf_ringbuf_discard(void *data, u64 flags);
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
- `data` ‚Äî —É–∫–∞–∑–∞—Ç–µ–ª—å –æ—Ç `bpf_ringbuf_reserve()`.
- `flags`:
  - `0` ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ.
  - `BPF_RB_NO_WAKEUP` / `BPF_RB_FORCE_WAKEUP` (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ `submit`).

**–ü—Ä–∏–º–µ—Ä**:
```c
if (e->pid == 0) {
    bpf_ringbuf_discard(e, 0);  // –ù–µ –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏—è –æ—Ç PID=0
    return 0;
}
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**:
- –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ —Å—Ç–∞–ª–∏ –Ω–µ–∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤ eBPF).
- –î–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞ –≤ –±—É—Ñ–µ—Ä–µ.

---

#### **4. `bpf_ringbuf_query()` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏**
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**:  
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –±—É—Ñ–µ—Ä–∞ (–∫–æ–ª-–≤–æ –¥–∞–Ω–Ω—ã—Ö, —Å–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ –∏ —Ç.–¥.).

**–°–∏–≥–Ω–∞—Ç—É—Ä–∞**:
```c
u64 bpf_ringbuf_query(struct bpf_map *ringbuf, u64 flags);
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
- `ringbuf` ‚Äî —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –±—É—Ñ–µ—Ä.
- `flags` ‚Äî —Ç–∏–ø –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:
  - `BPF_RB_AVAIL_DATA` ‚Äî –æ–±—ä—ë–º –¥–∞–Ω–Ω—ã—Ö, –≥–æ—Ç–æ–≤—ã—Ö –¥–ª—è —á—Ç–µ–Ω–∏—è.
  - `BPF_RB_RING_SIZE` ‚Äî –æ–±—â–∏–π —Ä–∞–∑–º–µ—Ä –±—É—Ñ–µ—Ä–∞.
  - `BPF_RB_CONS_POS` / `BPF_RB_PROD_POS` ‚Äî –ø–æ–∑–∏—Ü–∏–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è.

**–ü—Ä–∏–º–µ—Ä**:
```c
u64 avail_data = bpf_ringbuf_query(&ringbuf, BPF_RB_AVAIL_DATA);
bpf_printk("Available data: %llu bytes", avail_data);
```

**–í—ã–≤–æ–¥**:
```
Available data: 128 bytes
```

---

#### **5. `bpf_ringbuf_output()` ‚Äî –∑–∞–ø–∏—Å—å –±–µ–∑ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏—è**
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**:  
–ê–Ω–∞–ª–æ–≥ `bpf_ringbuf_reserve()` + `bpf_ringbuf_submit()` –≤ –æ–¥–Ω–æ–º –≤—ã–∑–æ–≤–µ (—É–¥–æ–±–Ω–æ –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Å–ª—É—á–∞–µ–≤).

**–°–∏–≥–Ω–∞—Ç—É—Ä–∞**:
```c
long bpf_ringbuf_output(struct bpf_map *ringbuf, void *data, u64 size, u64 flags);
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
- `ringbuf` ‚Äî —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –±—É—Ñ–µ—Ä.
- `data` ‚Äî —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–ø–∏—Å–∏.
- `size` ‚Äî —Ä–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö.
- `flags` ‚Äî –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ `bpf_ringbuf_submit()`.

**–ü—Ä–∏–º–µ—Ä**:
```c
struct event e = { .pid = 123 };
bpf_ringbuf_output(&ringbuf, &e, sizeof(e), 0);
```

**–ü–ª—é—Å—ã**:
- –£–¥–æ–±–Ω–æ –¥–ª—è –Ω–µ–±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö.
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞–º—è—Ç—å—é.

**–ú–∏–Ω—É—Å—ã**:
- –ú–µ–¥–ª–µ–Ω–Ω–µ–µ, —á–µ–º `reserve` + `submit` (–∏–∑-–∑–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö).

---

## **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π**
| –§—É–Ω–∫—Ü–∏—è                 | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?                    | –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å |
| ----------------------- | -------------------------------------- | ------------------ |
| `bpf_ringbuf_reserve()` | –î–ª—è —Å–ª–æ–∂–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–ª–µ–π). | ‚ö°Ô∏è –í—ã—Å–æ–∫–∞—è         |
| `bpf_ringbuf_output()`  | –î–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –¥–∞–Ω–Ω—ã—Ö (—Å—Ç—Ä—É–∫—Ç—É—Ä).         | üê¢ –°—Ä–µ–¥–Ω—è—è         |
| `bpf_ringbuf_query()`   | –î–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±—É—Ñ–µ—Ä–∞.      | üõ†Ô∏è –°–µ—Ä–≤–∏—Å–Ω–∞—è      |

---

## **–ü—Ä–∏–º–µ—Ä –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞**
```c
struct event *e = bpf_ringbuf_reserve(&ringbuf, sizeof(struct event), 0);
if (!e) return 0;

e->pid = bpf_get_current_pid_tgid();
bpf_ringbuf_submit(e, 0);  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º

u64 avail = bpf_ringbuf_query(&ringbuf, BPF_RB_AVAIL_DATA);
bpf_printk("Available: %llu", avail);
```

---

## **4. –ß—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ (libbpf)**
### **–ü—Ä–∏–º–µ—Ä –Ω–∞ C (libbpf)**
```c
#include <bpf/libbpf.h>
#include <stdio.h>

// –ö–æ–ª–±—ç–∫ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π
static int handle_event(void *ctx, void *data, size_t size) {
    struct event *e = data;
    printf("PID: %d, COMM: %s, Time: %llu\n", e->pid, e->comm, e->timestamp);
    return 0;
}

int main() {
    struct ring_buffer *rb = NULL;
    struct bpf_object *obj;
    int map_fd;

    // –ó–∞–≥—Ä—É–∑–∫–∞ eBPF-–ø—Ä–æ–≥—Ä–∞–º–º—ã
    obj = bpf_object__open("my_prog.bpf.o");
    bpf_object__load(obj);

    // –ü–æ–ª—É—á–µ–Ω–∏–µ fd ringbuf-–±—É—Ñ–µ—Ä–∞
    map_fd = bpf_object__find_map_fd_by_name(obj, "ringbuf");

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ring buffer
    rb = ring_buffer__new(map_fd, handle_event, NULL, NULL);

    while (1) {
        ring_buffer__poll(rb, 1000); // –û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π (—Ç–∞–π–º–∞—É—Ç 1 —Å–µ–∫)
    }

    ring_buffer__free(rb);
    return 0;
}
```

---

## –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —è–¥—Ä–µ (eBPF –ø—Ä–æ–≥—Ä–∞–º–º–∞)
```c
#include <linux/bpf.h>
#include <bpf/bpf_helpers.h>

// –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–±—ã—Ç–∏—è
struct event {
    u32 pid;
    char message[32];
};

// –ö–æ–ª—å—Ü–µ–≤–æ–π –±—É—Ñ–µ—Ä
struct {
    __uint(type, BPF_MAP_TYPE_RINGBUF);
    __uint(max_entries, 1 << 20); // 1 MB
} ringbuf SEC(".maps");

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏—è
static void log_event(const char *msg) {
    struct event *e;
    
    // –†–µ–∑–µ—Ä–≤–∏—Ä—É–µ–º –º–µ—Å—Ç–æ –≤ –±—É—Ñ–µ—Ä–µ
    e = bpf_ringbuf_reserve(&ringbuf, sizeof(struct event), 0);
    if (!e) return; // –ï—Å–ª–∏ –±—É—Ñ–µ—Ä –ø–æ–ª–æ–Ω

    e->pid = bpf_get_current_pid_tgid();
    bpf_probe_read_kernel_str(e->message, sizeof(e->message), msg);

    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏–µ:
    // 1-–µ —Å–æ–±—ã—Ç–∏–µ ‚Äî —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
    // 2-–µ —Å–æ–±—ã—Ç–∏–µ ‚Äî –±–µ–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (BPF_RB_NO_WAKEUP)
    if (msg[0] == 'A') {
        bpf_ringbuf_submit(e, 0); // –£–≤–µ–¥–æ–º–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    } else {
        bpf_ringbuf_submit(e, BPF_RB_NO_WAKEUP); // –ë–µ–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    }
}

// –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ —Å–∏—Å—Ç–µ–º–Ω–æ–º –≤—ã–∑–æ–≤–µ)
SEC("kprobe/sys_execve")
int handle_execve(void *ctx) {
    log_event("Event A: Process started");
    log_event("Event B: No wakeup");
    return 0;
}

char _license[] SEC("license") = "GPL";
```

## **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ (Python)**
```python
from bcc import BPF
import time

# –ó–∞–≥—Ä—É–∂–∞–µ–º eBPF-–ø—Ä–æ–≥—Ä–∞–º–º—É
bpf = BPF(src_file="ringbuf_example.bpf.c")

# –ö–æ–ª–±—ç–∫ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π
def handle_event(ctx, data, size):
    event = bpf["ringbuf"].event(data)
    print(f"PID: {event.pid}, Message: {event.message.decode()}")

# –û—Ç–∫—Ä—ã–≤–∞–µ–º –∫–æ–ª—å—Ü–µ–≤–æ–π –±—É—Ñ–µ—Ä('ringbuf') –∏ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è
bpf["ringbuf"].open_ring_buffer(handle_event)

print("Listening for events... Press Ctrl+C to exit")
try:
    while True:
        # –û–∂–∏–¥–∞–µ–º —Å–æ–±—ã—Ç–∏—è (—Ç–∞–π–º–∞—É—Ç 1 —Å–µ–∫)
        bpf.ring_buffer_consume()
        time.sleep(0.1)
except KeyboardInterrupt:
    pass
```

1. **–ü—Ä–∏ –≤—ã–∑–æ–≤–µ `sys_execve`** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–∞–ø—É—Å–∫ –ø—Ä–æ–≥—Ä–∞–º–º—ã):
    - eBPF-–ø—Ä–æ–≥—Ä–∞–º–º–∞ –∑–∞–ø–∏—à–µ—Ç **2 —Å–æ–±—ã—Ç–∏—è** –≤ `ringbuf`:
        - `Event A` ‚Äî —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º (`flags = 0`).
        - `Event B` ‚Äî –±–µ–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (`BPF_RB_NO_WAKEUP`).
2. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞**:
    - –°—Ä–∞–∑—É –ø–æ–ª—É—á–∏—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ `Event A` –∏ –≤—ã–≤–µ–¥–µ—Ç –µ–≥–æ.
    - `Event B` –±—É–¥–µ—Ç –ø—Ä–æ—á–∏—Ç–∞–Ω **—Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –≤—ã–∑–æ–≤–µ `ring_buffer_consume()`** (–∏–∑-–∑–∞ `BPF_RB_NO_WAKEUP`).

---
## **5. –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ `BPF_MAP_TYPE_RINGBUF`**
### **–ü–µ—Ä–µ–¥ `BPF_MAP_TYPE_PERF_EVENT_ARRAY` (perf_buffer)**
‚úÖ **–ú–µ–Ω—å—à–∏–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã** (–Ω–µ—Ç –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ `perf_event_output`).  
‚úÖ **–ë–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏** (–æ–±—â–∞—è –ø–∞–º—è—Ç—å –º–µ–∂–¥—É —è–¥—Ä–æ–º –∏ userspace).  
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ–º** (—Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è).  
‚úÖ **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ "zero-copy"** (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ —á–∏—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞–ø—Ä—è–º—É—é).  

### **–ü–µ—Ä–µ–¥ `BPF_MAP_TYPE_QUEUE/STACK`**
‚úÖ **–ì–æ—Ä–∞–∑–¥–æ –±–æ–ª—å—à–∞—è –ø—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å**.  
‚úÖ **–ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏** (—Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è).  
‚úÖ **–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ø–æ—Ç–æ–∫–æ–≤–æ–π –ø–µ—Ä–µ–¥–∞—á–∏** (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç—Ä–µ–π—Å–∏–Ω–≥ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤).  

---

## **6. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è**
‚ùå **–¢–æ–ª—å–∫–æ –æ–¥–Ω–æ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞** (—è–¥—Ä–æ ‚Üí userspace).  
‚ùå **–ù–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏–∏ –¥–æ—Å—Ç–∞–≤–∫–∏** (–ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ —Ç–µ—Ä—è—é—Ç—Å—è).  
‚ùå **–¢—Ä–µ–±—É–µ—Ç Linux 5.8+**.  

---

## **7. –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**
1. **–¢—Ä–µ–π—Å–∏–Ω–≥ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `openat`, `execve`).  
2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ç–µ–≤—ã—Ö –ø–∞–∫–µ—Ç–æ–≤** (XDP/TC-–ø—Ä–æ–≥—Ä–∞–º–º—ã).  
3. **–ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** (–ø–µ—Ä–µ–¥–∞—á–∞ –º–µ—Ç—Ä–∏–∫ CPU/–ø–∞–º—è—Ç–∏).  
4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π —è–¥—Ä–∞** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ñ–∞–π–ª–æ–≤).  

---

## **8. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
- **–ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å**: –¥–æ **–º–∏–ª–ª–∏–æ–Ω–æ–≤ —Å–æ–±—ã—Ç–∏–π –≤ —Å–µ–∫—É–Ω–¥—É**.  
- **–ó–∞–¥–µ—Ä–∂–∫–∞**: –º–∏–∫—Ä–æ—Å–µ–∫—É–Ω–¥—ã (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ –±—É—Ñ–µ—Ä–∞).  
- **–ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ CPU**: –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –º–µ–Ω—å—à–µ, —á–µ–º —É `perf_buffer`.  
