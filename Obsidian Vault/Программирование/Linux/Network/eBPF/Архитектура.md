## Последовательность прохождения пакета по основным слоям

1. Парсинг
2. Фильтрация
3. Коммутация
4. Анализ

## Парсинг

Отвечает за разбор заголовков пакета по данным структуры xdp_md.

- parse_eth - разбор заголовков ethhdr и vlan_hdr
- parse_ip - разбор заголовка iphdr или ipv6hdr  
    `Может быть перенести в parse_eth`
- parse_l3_l4 - разбор ip-заголовков:
    - tcphdr
    - udphdr 
    - icmphdr

## Фильтрация

Отвечает за принятие решение о пакете.

- FILTER_DROP - заблокировать пакет (fast-reject)
- FILTER_PASS - пропустить пакет (fast-accept)
- FILTER_CONT - фильтр не имеет инструкций для пакета, продолжить обработку

## Коммутация

Отвечает за изменение данных заголовков для правильной маршрутизации пакета и за код возврата из xdp-фильтра.

- XDP_DROP - заблокировать пакет, равно FILTER_DROP
- XDP_TX / XDP_REDIRECT - пропустить пакет, равно FILTER_PASS
- XDP_PASS - обработать пакет в сетевом стеке ядра, равно FILTER_CONT (xdp-фильтр не имеет обработчика для пакета)

В документации XDP-фильтра упоминается действие XDP_ABORTED - это внутреннее значение ядра, когда не получилось вызвать наш фильтр. Не должно использоваться, когда фильтр успешно стартовал.

## WIP: Аналитика

Отвечает за сложный анализ пакета или нескольких пакетов.
Контрмеры:
- rate-limit - блокировка трафика по 5-tuple при превышении порога частоты создания соединений