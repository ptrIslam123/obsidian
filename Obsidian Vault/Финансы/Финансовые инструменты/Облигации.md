
## виды облигаций

* **Облигации федерального займа (ОФЗ)** — это государственные облигации, которые выпускает Министерство финансов России. Их еще называют суверенными. Проценты по таким облигациям платит правительство России, оно же возвращает номинальную стоимость облигации при погашении. Важные особенности ОФЗ — их надежность, высокая ликвидность и много выпусков с разными сроками погашения.
* **Муниципальные (субфедеральные)** — это еще один вид государственных облигаций, эмитентом которых являются администрации субъектов Российской Федерации. Такие облигации считаются чуть менее надежными, чем ОФЗ, зато по ним предлагают более высокий процент дохода.
* **Корпоративные** — это облигации, которые выпускают частные компании, например Газпром, Сбер, Т-Банк или Яндекс. Такие облигации считаются более рисковыми по сравнению с государственными — но за этот риск они дают более высокую доходность.
* **Еврооблигации** — это облигации российских эмитентов, выпущенные в иностранной валюте, обычно в долларах или евро. Компания или государство выпускает еврооблигации, когда хочет занять деньги в валюте — в первую очередь у иностранных инвесторов.
* Замещающие облигации — это облигации российских компаний, выпущенные ими взамен своих же еврооблигаций. Номинал и купоны замещающих облигаций выражены в иностранной валюте, но инвесторам номинал и купоны выплачиваются в рублях по курсу ЦБ РФ на дату выплаты. Это позволяет выплачивать деньги без участия иностранных финансовых организаций. [Подробнее про замещающие облигации](https://www.tbank.ru/invest/help/replacement-bonds/)

## Параметры облигации

* **Текущая доходность** — показывает, какой доход вы получите, если купите облигацию по рыночной цене и продадите ее ровно через год.

* **Доходность к погашению** — это годовая процентная доходность, которую каждый год будет получать владелец облигации, если купит ее по текущей цене на рынке и будет держать до погашения. Доходность к погашению учитывает купонные выплаты, которые вы получите за время владения облигацией.

* **Дата погашения** — день, когда эмитент обязан вернуть долг владельцам облигации. Обычно этот день совпадает с датой последней купонной выплаты.

* **Накопленный купонный доход** — это часть купонного дохода, которую вам выплатит новый владелец облигации, если вы решите продать ее в промежутке между двумя купонными выплатами. Это одно из важных преимуществ облигаций по сравнению с обычными банковскими вкладами: облигации можно продать в любой момент, не потеряв при этом накопленный процентный доход.

* **Величина купона** — это размер периодических выплат за владение облигациями.

* **Номинал** — это сумма, которую владелец облигации получит за каждую облигацию в момент ее погашения. Кроме того, именно с этой суммы рассчитывается процент купонного дохода по облигациям. При этом стоимость облигации на бирже обычно отличается от ее номинала. Так происходит потому, что рыночная цена формируется на основе того, как много инвесторов хотят купить эту облигацию. Если люди верят в эмитента и считают его бумаги надежными для вложений, они с большей охотой будут покупать его облигации, и цена на них пойдет вверх.

* **Периодичность выплаты купона** — то, как часто вы будете получать купонный доход. Например, 91 — значит раз в три месяца, а 182 — раз в полгода.

* **Амортизация(Необязательный параметр).** Амортизация— это погашение части номинала облигации вместе с купонными выплатами. Это один из параметров облигации, говорящий о том, что номинальная стоимость возвращается не целиком в дату погашения, а частями вместе с выплатой купонов. В дату погашения такой облигации придет купон и последняя часть номинала. [Каждая частичная выплата уменьшает номинал облигации, и следующие купоны будут считаться в процентах уже только от непогашенной части номинала — то есть сумма купона в рублях тоже будет уменьшаться.]

* **Оферта(Необязательный параметр).** Оферта по облигации — это дата, в которую можно досрочно предъявить облигацию к погашению по номиналу. Например, если номинал облигации составляет 1 000 ₽, в дату оферты вы сможете получить всю эту сумму — даже если купили облигацию дешевле. Оферта позволяет инвестору выйти из облигации без потери вложений, если по каким‑то причинам условия по облигации его больше не устраивают. ` Для досрочного погашения(участия в оферте) нужно будет составить поручения у брокера об участии в этой самой оферте, в отличии от облигации без оферты, где вам ниего не нужно делать и просто дождать даты полного погашения облигации`

Дата оферты есть не у всех облигаций. Если она есть, это будет указано в карточке облигации в приложении Т-Инвестиций.

## ипотечные облигации
Ипотечные облигации — это один из видов долговых ценных бумаг. Они отличаются высокой надежностью, так как долг по ним обеспечен хорошим залогом в виде недвижимости.

Если говорить упрощенно, то ипотечные облигации устроены так:

1. Банк выдает клиентам ипотечные кредиты — для банка это надежный актив, потому что недвижимость находится у него в залоге. Если заемщик не сможет выплатить кредит, банк продаст недвижимость, чтобы вернуть деньги. В то же время этот актив для банка не очень ликвидный, потому что ждать полного возврата кредита приходится от 5 до 30 лет.

2. Банк продает ипотечные кредиты другой организации — так он быстро возвращает деньги, которые выдал клиентам в виде ипотеки. Организацию, выкупившую ипотечные кредиты, называют ипотечным агентом — обычно ее основным поручителем выступает сам банк или государственные финансовые институты. Деятельность ипотечного агента регулируется **статьей 8 закона «Об ипотечных ценных бумагах».**

3. Ипотечный агент размещает ипотечные облигации на бирже. Он делает это, чтобы заработать на разнице в процентах: условно, ипотечные кредиты выданы по ставке 8%, а купонные выплаты по ипотечным облигациям составляют 7%. Тогда разницу в 1% ипотечный агент оставляет себе в виде дохода.

4. Инвестор покупает ипотечные облигации на бирже, чтобы получать купонный доход. В целом ипотечные облигации — это бумаги, сравнимые по надежности с ОФЗ, но превышающие их по доходности.

Обычно каждый выпуск ипотечных облигаций длится от 10 лет и больше. Для инвестора это хороший способ надолго зафиксировать доходность, особенно если он ожидает, что процентные ставки снизятся.

С другой стороны, инвестору не обязательно держать купленную облигацию весь срок до погашения. Любую ипотечную облигацию вне зависимости от срока можно продать в любой торговый день биржи.

## субординированные облигации

**Субординированные облигации — это облигации, которые в России выпускают исключительно банки. Как правило, банки выпускают субординированные облигации, чтобы быстро увеличить свой капитал.** `(Сам по себе факт выпуска субординированных облигаций не смертелен, но говорит о том, что у банка возникли проблемы с достаточностью капитала)`

Такие бумаги имеют кредитный рейтинг на уровень ниже, чем другие облигации этого же эмитента. Это значит, что в случае ликвидации или банкротства эмитента держатели субординированных облигаций получат обратно свои вложения только после того, как компания полностью погасит обязательства перед основными кредиторами — по обычным облигациям, займам, кредитам и другим долгам.

Кроме того, субординированные облигации считаются менее надежными и более рискованными финансовыми инструментами по сравнению с обычными выпусками конкретного эмитента. Для них выделяют несколько основных рисков:
* **Риск списания**. Эмитент может списать номинал субординированных облигаций или его часть при определенных условиях — другими словами, инвестор может остаться не только без купонных выплат, но и без всех вложенных в такие облигации денег. Основания для списания установлены [в части 4 статьи 25.1 «Закона о банках и банковской деятельности».](https://www.consultant.ru/document/cons_doc_LAW_5842/10a8a103b8ea7021048caff282bdc6a1d2b13be6/#dst562)*

* **Риск остановки выплат.** Эмитент не обязан регулярно выплачивать купоны по субординированным облигациям и может в любой момент перестать их платить — и это не будет считаться нарушением условий договора с инвесторами.

* **Риск высокой дюрации.** Дюрация — это показатель, который отражает средний срок возврата инвестированных средств. Чем дольше срок, тем выше риск не получить обратно свои вложения. Так как срок погашения субординированных облигаций составляет не менее пяти лет, вероятность, что реализуется один из характерных для таких бумаг рисков, значительно увеличивается.

* **Риск низкой ликвидности** отражает, насколько легко инвестор сможет продать актив без необходимости снижать цену для привлечения покупателей. Если по активу небольшой объем торгов или торги по какой‑то причине приостановлены, продавцу придется долго ждать появления покупателя или согласиться на продажу по невыгодной для себя цене. Например, из‑за риска низкой ликвидности совершать сделки с субординированными облигациями могут только квалифицированные инвесторы. В декабре 2018 года Центральный банк внес соответствующие поправки [в закон о рынке ценных бумаг.](https://www.consultant.ru/document/cons_doc_LAW_314630/b004fed0b70d0f223e4a81f8ad6cd92af90a7e3b/)
Но в то же время такие бумаги предлагают и более высокую доходность по сравнению с обычными облигациями — купонные выплаты по субординированным облигациям в среднем на 1–3% выше.

## Рассчет полной доходности по облигациям

Рассчет полной доходности представляет собой:

$$ \text{Полная доходность в процентах} = \frac{\text{Чистый доход от облигации}}{\text{Суммарные издержки}} \times 100 $$

 где
$$ \text{Суммарные издержки} = \text{Рыночная стоимость на момент покупки} + \text{НКД(Накопленный купонный доход)} $$
 $$ \text{Чистый доход} = \text{Суммарный купонный доход} + \text{Суммарный амортизационный доход} + \text{Номинал} $$

* **Номинал** - в случае если облигация имеет амортизацию, то номинал с каждым купонным платежом уменьшается на размер амортизации. **Размер амортизации является как правило константой и вычисляется как % от изначального номинала**.

* **Суммарный амортизационный доход** - просто произведение амортизационного отчисления на количество всего выплат.

* **Суммарный купонный доход** - произведение купонного дохода на количество всего выплат. Как правило купонная выплата тоже константа, но если облигация имеет амортизацию, то купонная выплата не является константой, вычисляется как % от номинала, при условии что номинал при каждой выплате уменьшается на размер амортизации.

* **Количество всего выплат** - сколько раз с момента покупки до момента погашения/оферты должно производиться выплат купонов/амортизации. 
 
#### Алгоритм рассчет всего количества выплат купонов

* ***Определение промежутка между датой размещения и датой погашения** :
    - Это позволяет понять весь период существования облигации.
    
* ***Составление полной карты купонных выплат** :
    - На основе частоты выплат в год и очередной даты выплаты купона можно создать список всех возможных дат выплат за весь период существования облигации.
    
* **Фильтрация выплат по дате покупки** :
    - После составления полной карты купонных выплат, нужно оставить только те выплаты, которые происходят после даты покупки и до даты погашения.
    
* ***Подсчет количества оставшихся выплат** :
    - Просто посчитать количество оставшихся выплат в фильтрованном списке.
    

**Полная доходность облигации включает в себя все денежные потоки, полученные от покупки одной облигации, за вычетом всех затрат на приобретение этой облигации, умноженные на период владения облигацией. Этот подход позволяет учесть все купонные выплаты и номинальную стоимость облигации за весь период до ее погашения.**

В контексте облигаций, все денежные потоки от облигации включают в себя все купонные выплаты за весь период и номинальную стоимость облигации.   
  
Сумма всех денежных потоков от облигации включает:
- Купонные выплаты: это ежегодные (или иные периодичные) выплаты, которые инвестор получает от облигации в течение срока ее действия.  Купонные выплаты по облигации выражаются в процентном соотношении от ее номинальной стоимости. В облигациях без амортизации купонные выплаты обычно остаются постоянными, тогда как в облигациях с амортизацией они могут изменяться в зависимости от изменения номинальной стоимости облигации. Изменения в номинале облигации могут повлиять на размер купонных выплат, поскольку они обычно выражены в процентном отношении к номинальной стоимости.
- Номинальная стоимость: это сумма, которую инвестор получает в момент погашения облигации.   
  
Расчет полной доходности для облигаций с амортизацией и без амортизации будет различным из-за специфики амортизации номинала в облигациях с этой особенностью.  
  
1. **Полная доходность облигации без амортизации:**  
   - Для облигаций без амортизации полная доходность будет включать все купонные выплаты за период владения облигацией, номинальную стоимость облигации, рыночную стоимость на момент покупки и НКД - накопленный купонный доход (если применимо). Формула может быть представлена, как вы указали:  
   $$\text{Полная доходность без амортизации} = \text{Сумма всех купонных выплат} + \text{Номинал} - \text{Рыночная стоимость на момент покупки} + \text{НКД}$$  
  
2. **Полная доходность облигации с амортизацией:**  
   - Для облигаций с амортизацией полная доходность также включает все купонные выплаты, но в данном случае амортизационные отчисления также учитываются как часть денежных потоков. Амортизационные отчисления представляют собой части номинала, которые выплачиваются вместе с купонными выплатами. Формула для полной доходности облигации с амортизацией может быть представлена, как вы указали:  
   $$\text{Полная доходность с амортизацией} = \text{Сумма всех купонных выплат} + \text{Амортизационные отчисления} - \text{Рыночная стоимость на момент покупки} + \text{НКД}$$  
Формула полной доходности до даты оферты для облигации с амортизацией может быть представлена следующим образом:  
  
$$\text{Полная доходность до даты оферты} = \text{Сумма всех купонных выплат до даты оферты} + \text{Сумма всех амортизационных выплат до даты оферты} + (\text{Номинал} - \text{Сумма всех амортизационных выплат до даты оферты}) - \text{Стоимость покупки облигации} + \text{НКД}$$  
  
Эта формула учитывает все купонные выплаты и амортизационные выплаты до даты оферты, а также учитывает остаток номинальной стоимости после оферты. Рыночная стоимость на момент покупки и НКД также учитываются для расчета общей доходности до момента оферты.

Расчет полной доходности учитывает все денежные потоки от облигации, включая купонные выплаты, амортизационные отчисления (если применимо), номинальную стоимость, рыночную стоимость на момент покупки и НКД. Понимание различий в расчете полной доходности для облигаций с и без амортизации поможет инвесторам оценить ожидаемую доходность от своих инвестиций.

### Расчет купонных выплат

* **Без амортизации**: Можно определить количество купонных выплат, которые будут произведены за период владения облигацией, исходя из временного интервала между датой покупки и датой погашения в годах. Округление этого количества до целого числа вниз будет означать количество полных купонных выплат, а оставшаяся часть периода будет представлять НКД (Недосчитанные купоны).
```python
"""

- Доходность к погашению(Yield to Maturity)

- Накопленный купонный доход (Accrued Interest)

- Величина купона (Coupon value)

- Номинал (Face/Nominal Value)

- Частота/Периодичность выплат (Payment Frequency)

- Амортизация (Amortization)

- Оферта (Offer)

- Рыночная цена (Market price)

"""

class BondYTM:

def __init__(

self,

nominal_value : float,

accrued_interest : float,

coupon_value_in_percent : float,

amortization_value_in_percent : float,

payment_frequency : int,

market_price : float,

buyDate : datetime,

repaymentDate : datetime

):

self.nominal_value = nominal_value

self.accrued_interest = accrued_interest

self.coupon_value_in_percent = coupon_value_in_percent

self.payment_frequency = payment_frequency

self.amortization_value_in_percent = amortization_value_in_percent

self.market_price = market_price

self.buyDate = buyDate

self.repaymentDate = repaymentDate

  

def calc_payments_per_years(self) -> int:

diff_in_years = math.floor(self.repaymentDate.year - self.buyDate.year)

return diff_in_years * self.payment_frequency

def calc_coupon_value(self) -> float:

return self.nominal_value * self.coupon_value_in_percent / 100

  

def calc_amortization_value(self) -> float:

return self.nominal_value * self.amortization_value_in_percent / 100

  

def calc_YTM_in_percent(self) -> float:

payments_per_years = self.calc_payments_per_years()

total_income = 0

total_cost = self.market_price + self.accrued_interest

amortization_value = self.calc_amortization_value()

for _ in range(0, payments_per_years):

total_income += self.calc_coupon_value() + amortization_value

self.nominal_value -= amortization_value

total_income += self.nominal_value

net_incomes = (total_income - total_cost)

return (net_incomes * 100) / total_cost
```
* **С амортизацией**:


# Расчет доходности облигации

`G-спред`


